generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum MEDIA_TYPE {
  IMAGE
  VIDEO
  AUDIO
}

enum NOTIFICATION_TYPE {
  LIKE
  REPLY
  FOLLOW
  REPOST
}

model Profile {
  id       String  @id @default(uuid())
  bio      String? // User's bio
  location String? // User's location
  website  String? // User's personal website or blog

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime? // Soft delete timestamp

  user   User   @relation(fields: [userId], references: [id])
  userId String @unique // One-to-one relationship with User
}

model User {
  id       String  @id @default(uuid())
  email    String  @unique
  displayName String? // User's display name
  username String  @unique
  password String?
  avatar   String? // Direct URL to avatar image
  backgroundImage String? // Direct URL to background image

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete timestamp

  resetPasswordToken   String?   @unique // Token for password reset
  resetPasswordExpires DateTime? // Expiration date for the token

  // Relations

  posts   Post[] // One-to-many relationship with Post
  likes   Like[] // One-to-many relationship with Like
  bookmarks Bookmark[] // One-to-many relationship with Bookmark
  // reposts Repost[] // One-to-many relationship with Repost
  medias  Media[] // One-to-many relationship with Media
  profile Profile? // One-to-one relationship with Profile
  notifications Notification[] // One-to-many relationship with Notification

  following    UserFollowing[] @relation("Following")
  followers    UserFollowing[] @relation("Followers")
  blockedUsers UserBlocked[]   @relation("BlockedUsers")
  blockedBy    UserBlocked[]   @relation("BlockedBy")
  actorNotifications Notification[] @relation("NotificationActor")

  userSettings UserSettings?
}

model UserFollowing {
  id          String @id @default(uuid())
  followerId  String
  followingId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  follower  User @relation("Following", fields: [followerId], references: [id])
  following User @relation("Followers", fields: [followingId], references: [id])

  @@unique([followerId, followingId])
}

model UserBlocked {
  id            String @id @default(uuid())
  userId        String
  blockedUserId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user        User @relation("BlockedUsers", fields: [userId], references: [id])
  blockedUser User @relation("BlockedBy", fields: [blockedUserId], references: [id])

  @@unique([userId, blockedUserId])
}

model UserSettings {
  id String @id @default(uuid())

  notifications Boolean @default(true) // Whether the user wants notifications

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime? // Soft delete timestamp

  user   User   @relation(fields: [userId], references: [id])
  userId String @unique // One-to-one relationship with User
}

model Post {
  id      String @id @default(uuid())
  content String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete timestamp

  published Boolean @default(true) // Whether the post is published or not

  user   User   @relation(fields: [userId], references: [id])
  userId String

  parent    Post?     @relation("PostReplies", fields: [parentId], references: [id], onDelete: Cascade)
  parentId  String?   // If null, it's a top-level post; if set, it's a reply/comment

  repostOf   Post?    @relation("PostReposts", fields: [repostOfId], references: [id], onDelete: Cascade)
  repostOfId String?  // If set, this post is a repost (with or without comment) of another post
  reposts Post[] @relation("PostReposts") // All posts that are reposts of this post

  replies   Post[]    @relation("PostReplies") // All replies/comments to this post
  likes   Like[] // One-to-many relationship with Like
  // reposts Repost[]
  bookmarks Bookmark[] // One-to-many relationship with Bookmark
  medias Media[] // One-to-many relationship with Media
  notifications Notification[] // One-to-many relationship with Notification
}

model Like {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String

  post      Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId    String?

  @@unique([userId, postId])
}

model Bookmark {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String

  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId    String

  @@unique([userId, postId])
}

model Media {
  id   String     @id @default(uuid())
  url  String // Direct URL to the media file
  filePath  String // Local file path to the media file
  type MEDIA_TYPE // Type of media (e.g., image, video, audio)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime? // Soft delete timestamp

  post   Post   @relation(fields: [postId], references: [id])
  postId String

  user   User   @relation(fields: [userId], references: [id])
  userId String
}

model Notification {
  id        String   @id @default(uuid())
  type      NOTIFICATION_TYPE // Type of notification (e.g., like, comment, follow)
  message   String // Notification message
  read      Boolean @default(false) // Whether the notification has been read
  createdAt DateTime @default(now())

  actor   User   @relation("NotificationActor", fields: [actorId], references: [id])
  actorId String

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String

  post      Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId    String? // If null, the notification is not related to a specific post

  @@index([userId])
}